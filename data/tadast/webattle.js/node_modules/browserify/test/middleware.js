var assert = require('assert');
var fs = require('fs');
var vm = require('vm');
var browserify = require('browserify');

exports.middleware = function () {
    var bundle = browserify().use(function (b) {
        b.include(
            __dirname + '/middieware.js',
            '/node_modules/middleware/index.js',
            'module.exports = 555'
        );
    });
    
    bundle.require('middleware');
    
    var src = bundle.bundle();
    var c = { console : console };
    vm.runInNewContext(src, c);
    
    assert.equal(c.require('middleware'), 555);
};

exports.fn = function () {
    var b = browserify().append('doom');
    assert.equal(typeof b, 'function');
    assert.equal(typeof b.bundle, 'function');
};
